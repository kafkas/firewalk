<!DOCTYPE html><html class="default" lang="en" data-base="."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>firewalk</title><meta name="description" content="Documentation for firewalk"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">firewalk</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>firewalk</h1></div><div class="tsd-panel tsd-typography"><div align="center">
  <img src="media/logo.png" width="240px" alt="header" />
</div>
<h1 align="center">
  firewalk
</h1>
<p align="center">
  A light, fast, and memory-efficient collection traversal library for Firestore and Node.js.
</p>
<p align="center">
    <a href="https://github.com/kafkas/firewalk/blob/main/LICENSE">
    <img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="Firewalk is released under the MIT license." /></a>
    <a href="https://npmjs.com/package/firewalk" alt="Version">
        <img src="https://img.shields.io/npm/v/firewalk" /></a>
    <a href="https://npmjs.com/package/firewalk" alt="Size">
        <img src="https://img.shields.io/bundlephobia/min/firewalk" /></a>
    <a href="https://npmjs.com/package/firewalk" alt="Downloads">
        <img src="https://img.shields.io/npm/dm/firewalk" /></a>
    <a href="https://" alt="Types">
        <img src="https://img.shields.io/npm/types/firewalk" /></a>
    <a href="https://github.com/kafkas/firewalk">
    <img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg" alt="PRs welcome!" /></a>
</p>
<p>Firewalk is a Node.js library that <em>walks</em> you through Firestore collections.</p>
<p>When you have millions of documents in a collection and you need to make changes to them or just read them, you can't just retrieve all of them at once as your program's memory usage will explode. Firewalk's configurable traverser objects let you do this in a simple, intuitive and memory-efficient way using batch processing with concurrency control.</p>
<p>Firewalk is an extremely light and well-typed library that is useful in a variety of scenarios. You can use it in database migration scripts (e.g. when you need to add a new field to all docs) or a scheduled Cloud Function that needs to check every doc in a collection periodically or even a locally run script that retrieves some data from a collection.</p>
<p><a href="https://anarkafkas.medium.com/traversing-firestore-collections-efficiently-6e43cea1eefd"><strong>Read the introductory blog post ▸</strong></a></p>
<p><a href="https://kafkas.github.io/firewalk"><strong>View the full documentation (docs) ▸</strong></a></p>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ol>
<li><a href="#Prerequisites">Prerequisites</a>
<ol>
<li><a href="#Compatibility-Map">Compatibility Map</a></li>
</ol>
</li>
<li><a href="#Installation">Installation</a></li>
<li><a href="#Core-Concepts">Core Concepts</a></li>
<li><a href="#Quick-Start">Quick Start</a></li>
<li><a href="#More-Examples">More Examples</a></li>
<li><a href="#API">API</a></li>
<li><a href="#Upgrading">Upgrading</a></li>
<li><a href="#License">License</a></li>
</ol>
<a id="prerequisites" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Prerequisites<a href="#prerequisites" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Firewalk is designed to work with the <a href="https://github.com/firebase/firebase-admin-node">Firebase Admin SDK</a> so if you haven't already installed it, you'll need add it as a dependency to your project.</p>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">firebase-admin</span>
</code><button type="button">Copy</button></pre>

<a id="compatibility-table" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Compatibility Table<a href="#compatibility-table" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Make sure to install the right version of Firewalk depending on the <code>firebase-admin</code> version your project is on.</p>
<table>
<thead>
<tr>
<th>firewalk</th>
<th>firebase-admin</th>
</tr>
</thead>
<tbody>
<tr>
<td>v1</td>
<td>v9-10</td>
</tr>
<tr>
<td>v2</td>
<td>v11-13</td>
</tr>
</tbody>
</table>
<a id="installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can add Firewalk to your project with npm or yarn.</p>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">firewalk</span>
</code><button type="button">Copy</button></pre>

<a id="core-concepts" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Concepts<a href="#core-concepts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>There are only 2 kinds of objects you need to be familiar with when using this library:</p>
<ol>
<li>
<p><strong>Traverser</strong>: An object that walks you through a collection of documents (or more generally a <a href="https://kafkas.github.io/firewalk/v2/types/Traversable.html">Traversable</a>).</p>
</li>
<li>
<p><strong>Migrator</strong>: A convenience object used for database migrations. It lets you easily write to the documents within a given traversable and uses a traverser to do that. You can easily write your own migration logic in the traverser callback if you don't want to use a migrator.</p>
</li>
</ol>
<a id="quick-start" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Quick Start<a href="#quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Suppose we have a <code>users</code> collection and we want to send an email to each user. This is how easy it is to do that efficiently with a Firewalk traverser:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">firestore</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;firebase-admin&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">createTraverser</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;firewalk&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">usersCollection</span><span class="hl-1"> = </span><span class="hl-0">firestore</span><span class="hl-1">().</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">traverser</span><span class="hl-1"> = </span><span class="hl-0">createTraverser</span><span class="hl-1">(</span><span class="hl-4">usersCollection</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">batchCount</span><span class="hl-1">, </span><span class="hl-6">docCount</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">traverser</span><span class="hl-1">.</span><span class="hl-0">traverse</span><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">batchDocs</span><span class="hl-1">, </span><span class="hl-4">batchIndex</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">batchSize</span><span class="hl-1"> = </span><span class="hl-4">batchDocs</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">.</span><span class="hl-0">all</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">batchDocs</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">doc</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">email</span><span class="hl-1">, </span><span class="hl-6">firstName</span><span class="hl-1"> } = </span><span class="hl-4">doc</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">sendEmail</span><span class="hl-1">({ </span><span class="hl-4">to:</span><span class="hl-1"> </span><span class="hl-4">email</span><span class="hl-1">, </span><span class="hl-4">content:</span><span class="hl-1"> </span><span class="hl-2">`Hello </span><span class="hl-5">${</span><span class="hl-4">firstName</span><span class="hl-5">}</span><span class="hl-2">!`</span><span class="hl-1"> });</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Batch </span><span class="hl-5">${</span><span class="hl-4">batchIndex</span><span class="hl-5">}</span><span class="hl-2"> done! We emailed </span><span class="hl-5">${</span><span class="hl-4">batchSize</span><span class="hl-5">}</span><span class="hl-2"> users in this batch.`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Traversal done! We emailed </span><span class="hl-5">${</span><span class="hl-4">docCount</span><span class="hl-5">}</span><span class="hl-2"> users in </span><span class="hl-5">${</span><span class="hl-4">batchCount</span><span class="hl-5">}</span><span class="hl-2"> batches!`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>We are doing 3 things here:</p>
<ol>
<li>Create a reference to the <code>users</code> collection</li>
<li>Pass that reference to the <code>createTraverser()</code> function</li>
<li>Invoke <code>.traverse()</code> with an async callback that is called for each batch of document snapshots</li>
</ol>
<p>This pretty much sums up the core functionality of this library! The <code>.traverse()</code> method returns a Promise that resolves when the entire traversal finishes, which can take a while if you have millions of docs. The Promise resolves with an object containing the traversal details e.g. the number of docs you touched.</p>
<a id="more-examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">More Examples<a href="#more-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="traverse-faster-by-increasing-concurrency" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Traverse faster by increasing concurrency<a href="#traverse-faster-by-increasing-concurrency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">projectsColRef</span><span class="hl-1"> = </span><span class="hl-0">firestore</span><span class="hl-1">().</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;projects&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">traverser</span><span class="hl-1"> = </span><span class="hl-0">createTraverser</span><span class="hl-1">(</span><span class="hl-4">projectsColRef</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">batchSize:</span><span class="hl-1"> </span><span class="hl-8">500</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">// This means we are prepared to hold 500 * 20 = 10,000 docs in memory.</span><br/><span class="hl-1">  </span><span class="hl-9">// We sacrifice some memory to traverse faster.</span><br/><span class="hl-1">  </span><span class="hl-4">maxConcurrentBatchCount:</span><span class="hl-1"> </span><span class="hl-8">20</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">docCount</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">traverser</span><span class="hl-1">.</span><span class="hl-0">traverse</span><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">batchIndex</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Gonna process batch </span><span class="hl-5">${</span><span class="hl-4">batchIndex</span><span class="hl-5">}</span><span class="hl-2"> now!`</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-9">// ...</span><br/><span class="hl-1">});</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Traversed </span><span class="hl-5">${</span><span class="hl-4">docCount</span><span class="hl-5">}</span><span class="hl-2"> projects super-fast!`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="add-a-new-field-using-a-migrator" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Add a new field using a migrator<a href="#add-a-new-field-using-a-migrator" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">projectsColRef</span><span class="hl-1"> = </span><span class="hl-0">firestore</span><span class="hl-1">().</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;projects&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">migrator</span><span class="hl-1"> = </span><span class="hl-0">createMigrator</span><span class="hl-1">(</span><span class="hl-4">projectsColRef</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">migratedDocCount</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">migrator</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-2">&#39;isCompleted&#39;</span><span class="hl-1">, </span><span class="hl-5">false</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Updated </span><span class="hl-5">${</span><span class="hl-4">migratedDocCount</span><span class="hl-5">}</span><span class="hl-2"> projects!`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="add-a-new-field-derived-from-the-previous-fields" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Add a new field derived from the previous fields<a href="#add-a-new-field-derived-from-the-previous-fields" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-7">UserDoc</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">firstName</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">lastName</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">usersColRef</span><span class="hl-1"> = </span><span class="hl-0">firestore</span><span class="hl-1">().</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;users&#39;</span><span class="hl-1">) </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-7">firestore</span><span class="hl-1">.</span><span class="hl-7">CollectionReference</span><span class="hl-1">&lt;</span><span class="hl-7">UserDoc</span><span class="hl-1">&gt;;</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">migrator</span><span class="hl-1"> = </span><span class="hl-0">createMigrator</span><span class="hl-1">(</span><span class="hl-4">usersColRef</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">migratedDocCount</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">migrator</span><span class="hl-1">.</span><span class="hl-0">updateWithDerivedData</span><span class="hl-1">((</span><span class="hl-4">snap</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">firstName</span><span class="hl-1">, </span><span class="hl-6">lastName</span><span class="hl-1"> } = </span><span class="hl-4">snap</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">fullName:</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-5">${</span><span class="hl-4">firstName</span><span class="hl-5">}</span><span class="hl-2"> </span><span class="hl-5">${</span><span class="hl-4">lastName</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">});</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Updated </span><span class="hl-5">${</span><span class="hl-4">migratedDocCount</span><span class="hl-5">}</span><span class="hl-2"> users!`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="migrate-faster-by-increasing-concurrency" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Migrate faster by increasing concurrency<a href="#migrate-faster-by-increasing-concurrency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">projectsColRef</span><span class="hl-1"> = </span><span class="hl-0">firestore</span><span class="hl-1">().</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;projects&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">migrator</span><span class="hl-1"> = </span><span class="hl-0">createMigrator</span><span class="hl-1">(</span><span class="hl-4">projectsColRef</span><span class="hl-1">, { </span><span class="hl-4">maxConcurrentBatchCount:</span><span class="hl-1"> </span><span class="hl-8">25</span><span class="hl-1"> });</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">migratedDocCount</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">migrator</span><span class="hl-1">.</span><span class="hl-0">update</span><span class="hl-1">(</span><span class="hl-2">&#39;isCompleted&#39;</span><span class="hl-1">, </span><span class="hl-5">false</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Updated </span><span class="hl-5">${</span><span class="hl-4">migratedDocCount</span><span class="hl-5">}</span><span class="hl-2"> projects super-fast!`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="change-traversal-config" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Change traversal config<a href="#change-traversal-config" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">walletsWithNegativeBalance</span><span class="hl-1"> = </span><span class="hl-0">firestore</span><span class="hl-1">().</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&#39;wallets&#39;</span><span class="hl-1">).</span><span class="hl-0">where</span><span class="hl-1">(</span><span class="hl-2">&#39;money&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&lt;&#39;</span><span class="hl-1">, </span><span class="hl-8">0</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">migrator</span><span class="hl-1"> = </span><span class="hl-0">createMigrator</span><span class="hl-1">(</span><span class="hl-4">walletsWithNegativeBalance</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-9">// We want each batch to have 500 docs. The size of the very last batch may be less than 500</span><br/><span class="hl-1">  </span><span class="hl-4">batchSize:</span><span class="hl-1"> </span><span class="hl-8">500</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">// We want to wait 500ms before moving to the next batch</span><br/><span class="hl-1">  </span><span class="hl-4">sleepTimeBetweenBatches:</span><span class="hl-1"> </span><span class="hl-8">500</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-9">// Wipe out their debts!</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">migratedDocCount</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">migrator</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">({ </span><span class="hl-4">money:</span><span class="hl-1"> </span><span class="hl-8">0</span><span class="hl-1"> });</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Set </span><span class="hl-5">${</span><span class="hl-4">migratedDocCount</span><span class="hl-5">}</span><span class="hl-2"> wallets!`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="rename-a-field" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Rename a field<a href="#rename-a-field" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">postsColGroup</span><span class="hl-1"> = </span><span class="hl-0">firestore</span><span class="hl-1">().</span><span class="hl-0">collectionGroup</span><span class="hl-1">(</span><span class="hl-2">&#39;posts&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">migrator</span><span class="hl-1"> = </span><span class="hl-0">createMigrator</span><span class="hl-1">(</span><span class="hl-4">postsColGroup</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">migratedDocCount</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">migrator</span><span class="hl-1">.</span><span class="hl-0">renameField</span><span class="hl-1">(</span><span class="hl-2">&#39;postedAt&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;publishedAt&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Updated </span><span class="hl-5">${</span><span class="hl-4">migratedDocCount</span><span class="hl-5">}</span><span class="hl-2"> posts!`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="api" class="tsd-anchor"></a><h2 class="tsd-anchor-link"><a href="https://kafkas.github.io/firewalk">API</a><a href="#api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can find the full API reference for Firewalk <a href="https://kafkas.github.io/firewalk">here</a>. We maintain detailed docs for each major version. Here are some of the core functions that this library provides.</p>
<a id="createtraverser-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><a href="https://kafkas.github.io/firewalk/v2/functions/createTraverser.html">createTraverser</a><a href="#createtraverser-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Creates an object which can be used to traverse a Firestore collection or, more generally, a <a href="https://kafkas.github.io/firewalk/v2/types/Traversable.html">Traversable</a>.</p>
<p>For each batch of document snapshots in the traversable, the traverser invokes a specified async callback and immediately moves to the next batch. It does not wait for the callback Promise to resolve before moving to the next batch. That is, when <code>maxConcurrentBatchCount</code> &gt; 1, there is no guarantee that any given batch will finish processing before a later batch.</p>
<p>The traverser becomes faster as you increase <code>maxConcurrentBatchCount</code>, but this will consume more memory. You should increase concurrency when you want to trade some memory for speed.</p>
<a id="complexity" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Complexity:<a href="#complexity" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>Time complexity: <em>O</em>((<em>N</em> / <code>batchSize</code>) * (<em>Q</em>(<code>batchSize</code>) + <em>C</em>(<code>batchSize</code>) / <code>maxConcurrentBatchCount</code>))</li>
<li>Space complexity: <em>O</em>(<code>maxConcurrentBatchCount</code> * (<code>batchSize</code> * <em>D</em> + <em>S</em>))</li>
<li>Billing: <em>max</em>(1, <em>N</em>) reads</li>
</ul>
<p>where:</p>
<ul>
<li><em>N</em>: number of docs in the traversable</li>
<li><em>Q</em>(<code>batchSize</code>): average batch query time</li>
<li><em>C</em>(<code>batchSize</code>): average callback processing time</li>
<li><em>D</em>: average document size</li>
<li><em>S</em>: average extra space used by the callback</li>
</ul>
<a id="createmigrator-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><a href="https://kafkas.github.io/firewalk/v2/functions/createMigrator.html">createMigrator</a><a href="#createmigrator-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Creates a migrator that facilitates database migrations. The migrator accepts a custom traverser to traverse the collection. Otherwise it will create a default traverser with your desired traversal config. This migrator does not use atomic batch writes so it is possible that when a write fails other writes go through.</p>
<a id="complexity-1" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Complexity:<a href="#complexity-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>Time complexity: <em>TC</em>(<code>traverser</code>) where <em>C</em>(<code>batchSize</code>) = <em>W</em>(<code>batchSize</code>)</li>
<li>Space complexity: <em>SC</em>(<code>traverser</code>) where <em>S</em> = <em>O</em>(<code>batchSize</code>)</li>
<li>Billing: <em>max</em>(1, <em>N</em>) reads, <em>K</em> writes</li>
</ul>
<p>where:</p>
<ul>
<li><em>N</em>: number of docs in the traversable</li>
<li><em>K</em>: number of docs that passed the migration predicate (<em>K</em>&lt;=<em>N</em>)</li>
<li><em>W</em>(<code>batchSize</code>): average batch write time</li>
<li><em>TC</em>(<code>traverser</code>): time complexity of the underlying traverser</li>
<li><em>SC</em>(<code>traverser</code>): space complexity of the underlying traverser</li>
</ul>
<a id="createbatchmigrator-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><a href="https://kafkas.github.io/firewalk/v2/functions/createBatchMigrator.html">createBatchMigrator</a><a href="#createbatchmigrator-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Creates a migrator that facilitates database migrations. The migrator accepts a custom traverser to traverse the collection. Otherwise it will create a default traverser with your desired traversal config. This migrator uses atomic batch writes so the entire operation will fail if a single write isn't successful.</p>
<a id="complexity-2" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Complexity:<a href="#complexity-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>Time complexity: <em>TC</em>(<code>traverser</code>) where <em>C</em>(<code>batchSize</code>) = <em>W</em>(<code>batchSize</code>)</li>
<li>Space complexity: <em>SC</em>(<code>traverser</code>) where <em>S</em> = <em>O</em>(<code>batchSize</code>)</li>
<li>Billing: <em>max</em>(1, <em>N</em>) reads, <em>K</em> writes</li>
</ul>
<p>where:</p>
<ul>
<li><em>N</em>: number of docs in the traversable</li>
<li><em>K</em>: number of docs that passed the migration predicate (<em>K</em>&lt;=<em>N</em>)</li>
<li><em>W</em>(<code>batchSize</code>): average batch write time</li>
<li><em>TC</em>(<code>traverser</code>): time complexity of the underlying traverser</li>
<li><em>SC</em>(<code>traverser</code>): space complexity of the underlying traverser</li>
</ul>
<a id="upgrading" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Upgrading<a href="#upgrading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This project adheres to <a href="https://semver.org">SemVer</a>. Before upgrading to a new major version, make sure to check out the <a href="https://github.com/kafkas/firewalk/releases">Releases</a> page to view all the breaking changes.</p>
<a id="license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This project is made available under the MIT License.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#overview"><span>Overview</span></a><a href="#prerequisites"><span>Prerequisites</span></a><ul><li><a href="#compatibility-table"><span>Compatibility <wbr/>Table</span></a></li></ul><a href="#installation"><span>Installation</span></a><a href="#core-concepts"><span>Core <wbr/>Concepts</span></a><a href="#quick-start"><span>Quick <wbr/>Start</span></a><a href="#more-examples"><span>More <wbr/>Examples</span></a><ul><li><a href="#traverse-faster-by-increasing-concurrency"><span>Traverse faster by increasing concurrency</span></a></li><li><a href="#add-a-new-field-using-a-migrator"><span>Add a new field using a migrator</span></a></li><li><a href="#add-a-new-field-derived-from-the-previous-fields"><span>Add a new field derived from the previous fields</span></a></li><li><a href="#migrate-faster-by-increasing-concurrency"><span>Migrate faster by increasing concurrency</span></a></li><li><a href="#change-traversal-config"><span>Change traversal config</span></a></li><li><a href="#rename-a-field"><span>Rename a field</span></a></li></ul><a href="#api"><span>API</span></a><ul><li><a href="#createtraverser-1"><span>create<wbr/>Traverser</span></a></li><li><ul><li><a href="#complexity"><span>Complexity:</span></a></li></ul></li><li><a href="#createmigrator-1"><span>create<wbr/>Migrator</span></a></li><li><ul><li><a href="#complexity-1"><span>Complexity:</span></a></li></ul></li><li><a href="#createbatchmigrator-1"><span>create<wbr/>Batch<wbr/>Migrator</span></a></li><li><ul><li><a href="#complexity-2"><span>Complexity:</span></a></li></ul></li></ul><a href="#upgrading"><span>Upgrading</span></a><a href="#license"><span>License</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">firewalk</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
