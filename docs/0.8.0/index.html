<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@firecode/admin - v0.8.0</title>
	<meta name="description" content="Documentation for @firecode/admin - v0.8.0">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@firecode/admin - v0.8.0</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>@firecode/admin - v0.8.0</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<h1 align="center">
					<a href="https://kafkas.github.io/firecode">
						Firecode
					</a>
				</h1>
				<p align="center">
					A light, fast, and memory-efficient collection traversal library for Firestore and Node.js.
				</p>
				<hr>
				<p align="center">
					<a href="https://github.com/kafkas/firecode/blob/main/LICENSE">
					<img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="Firecode is released under the MIT license." /></a>
					<a href="https://npmjs.com/package/@firecode/admin" alt="Version">
					<img src="https://img.shields.io/npm/v/@firecode/admin" /></a>
					<a href="https://npmjs.com/package/@firecode/admin" alt="Size">
					<img src="https://img.shields.io/bundlephobia/min/@firecode/admin" /></a>
					<a href="https://npmjs.com/package/@firecode/admin" alt="Downloads">
					<img src="https://img.shields.io/npm/dm/@firecode/admin" /></a>
					<a href="https://" alt="Types">
					<img src="https://img.shields.io/npm/types/@firecode/admin" /></a>
					<a href="https://github.com/kafkas/firecode" alt="Activity">
					<img src="https://img.shields.io/github/commit-activity/m/kafkas/firecode" /></a>
					<a href="https://" alt="Last Commit">
					<img src="https://img.shields.io/github/last-commit/kafkas/firecode" /></a>
					<a href="https://lerna.js.org/" alt="Framework">
					<img src="https://img.shields.io/badge/maintained%20with-lerna-cc00ff.svg" /></a>
					<a href="https://kafkas.github.io/firecode/0.7.2/">
					<img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg" alt="PRs welcome!" /></a>
				</p>
				<p>Firecode is a Node.js library that lets you efficiently traverse Firestore collections.</p>
				<p>When you have millions of documents in a collection, you can&#39;t just get all of them at once as your program&#39;s memory usage will explode. Firecode&#39;s configurable traverser objects let you do this in a simple, intuitive and memory-efficient way using batching.</p>
				<p>Firecode is an extremely light, well-typed, zero-dependency library that is useful in a variety of scenarios. You can use it in database migration scripts (e.g. when you need to add a new field to all docs) or a scheduled Cloud Function that needs to check every doc in a collection periodically or a locally run script that retrieves some data from a collection.</p>
				<p><a href="https://anarkafkas.medium.com/traversing-firestore-collections-efficiently-6e43cea1eefd"><strong>Read the introductory blog post ▸</strong></a></p>
				<p><a href="https://kafkas.github.io/firecode"><strong>View the full documentation (docs)▸</strong></a></p>
				<a href="#overview" id="overview" style="color: inherit; text-decoration: none;">
					<h2>Overview</h2>
				</a>
				<ol>
					<li><a href="#Installation">Installation</a></li>
					<li><a href="#Core-Concepts">Core Concepts</a></li>
					<li><a href="#Quick-Start">Quick Start</a></li>
					<li><a href="#More-Examples">More Examples</a></li>
					<li><a href="#API">API</a></li>
					<li><a href="#Upgrading">Upgrading</a></li>
					<li><a href="#License">License</a></li>
				</ol>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<p>Firecode is designed to work with the <a href="https://github.com/firebase/firebase-admin-node">Firebase Admin SDK</a> so if you haven&#39;t already installed it, run</p>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> </span><span style="color: #001080">firebase</span><span style="color: #000000">-</span><span style="color: #001080">admin</span>
</code></pre>
				<p>Then run</p>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> @</span><span style="color: #001080">firecode</span><span style="color: #000000">/</span><span style="color: #001080">admin</span>
</code></pre>
				<a href="#core-concepts" id="core-concepts" style="color: inherit; text-decoration: none;">
					<h2>Core Concepts</h2>
				</a>
				<p>There are only 2 kinds of objects you need to be familiar with when using this library:</p>
				<ol>
					<li><p><strong>Traverser</strong>: An object that walks you through a collection of documents (or more generally a <a href="https://kafkas.github.io/firecode/0.7.2/modules.html#traversable">Traversable</a>).</p>
					</li>
					<li><p><strong>Migrator</strong>: A convenience object used for database migrations. It lets you easily write to the documents within a given traversable and uses a traverser to do that. You can easily write your own migration logic in the traverser callback if you don&#39;t want to use a migrator.</p>
					</li>
				</ol>
				<a href="#quick-start" id="quick-start" style="color: inherit; text-decoration: none;">
					<h2>Quick Start</h2>
				</a>
				<p>Suppose we have a <code>users</code> collection and we want to send an email to each user. This is how easy it is to do that efficiently with a Firecode traverser:</p>
				<pre><code class="language-ts"><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">firestore</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;firebase-admin&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">createTraverser</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;@firecode/admin&#039;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">usersCollection</span><span style="color: #000000"> = </span><span style="color: #795E26">firestore</span><span style="color: #000000">().</span><span style="color: #795E26">collection</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;users&#039;</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">traverser</span><span style="color: #000000"> = </span><span style="color: #795E26">createTraverser</span><span style="color: #000000">(</span><span style="color: #001080">usersCollection</span><span style="color: #000000">);</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">batchCount</span><span style="color: #000000">, </span><span style="color: #0070C1">docCount</span><span style="color: #000000"> } = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">traverser</span><span style="color: #000000">.</span><span style="color: #795E26">traverse</span><span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> (</span><span style="color: #001080">batchDocs</span><span style="color: #000000">, </span><span style="color: #001080">batchIndex</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">batchSize</span><span style="color: #000000"> = </span><span style="color: #001080">batchDocs</span><span style="color: #000000">.</span><span style="color: #001080">length</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #267F99">Promise</span><span style="color: #000000">.</span><span style="color: #795E26">all</span><span style="color: #000000">(</span>
<span style="color: #000000">    </span><span style="color: #001080">batchDocs</span><span style="color: #000000">.</span><span style="color: #795E26">map</span><span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> (</span><span style="color: #001080">snapshot</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">email</span><span style="color: #000000">, </span><span style="color: #0070C1">firstName</span><span style="color: #000000"> } = </span><span style="color: #001080">snapshot</span><span style="color: #000000">.</span><span style="color: #795E26">data</span><span style="color: #000000">();</span>
<span style="color: #000000">      </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">sendEmail</span><span style="color: #000000">({ </span><span style="color: #001080">to:</span><span style="color: #000000"> </span><span style="color: #001080">email</span><span style="color: #000000">, </span><span style="color: #001080">content:</span><span style="color: #000000"> </span><span style="color: #A31515">`Hello </span><span style="color: #0000FF">${</span><span style="color: #001080">firstName</span><span style="color: #0000FF">}</span><span style="color: #A31515">!`</span><span style="color: #000000"> });</span>
<span style="color: #000000">    })</span>
<span style="color: #000000">  );</span>
<span style="color: #000000">  </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Batch </span><span style="color: #0000FF">${</span><span style="color: #001080">batchIndex</span><span style="color: #0000FF">}</span><span style="color: #A31515"> done! We emailed </span><span style="color: #0000FF">${</span><span style="color: #001080">batchSize</span><span style="color: #0000FF">}</span><span style="color: #A31515"> users in this batch.`</span><span style="color: #000000">);</span>
<span style="color: #000000">});</span>

<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Traversal done! We emailed </span><span style="color: #0000FF">${</span><span style="color: #001080">docCount</span><span style="color: #0000FF">}</span><span style="color: #A31515"> users in </span><span style="color: #0000FF">${</span><span style="color: #001080">batchCount</span><span style="color: #0000FF">}</span><span style="color: #A31515"> batches!`</span><span style="color: #000000">);</span>
</code></pre>
				<p>We are doing 3 things here:</p>
				<ol>
					<li>Create a reference to the <code>users</code> collection</li>
					<li>Pass that reference to the <code>createTraverser()</code> function</li>
					<li>Invoke <code>.traverse()</code> with an async callback that is called for each batch of document snapshots</li>
				</ol>
				<p>This pretty much sums up the core functionality of this library! The <code>.traverse()</code> method returns a Promise that resolves when the entire traversal finishes, which can take a while if you have millions of docs. The Promise resolves with an object containing the traversal details e.g. the number of docs you touched.</p>
				<a href="#more-examples" id="more-examples" style="color: inherit; text-decoration: none;">
					<h2>More Examples</h2>
				</a>
				<a href="#use-a-fast-traverser" id="use-a-fast-traverser" style="color: inherit; text-decoration: none;">
					<h3>Use a fast traverser</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">projectsColRef</span><span style="color: #000000"> = </span><span style="color: #795E26">firestore</span><span style="color: #000000">().</span><span style="color: #795E26">collection</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;projects&#039;</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">traverser</span><span style="color: #000000"> = </span><span style="color: #795E26">createFastTraverser</span><span style="color: #000000">(</span><span style="color: #001080">projectsColRef</span><span style="color: #000000">, {</span>
<span style="color: #000000">  </span><span style="color: #001080">batchSize:</span><span style="color: #000000"> </span><span style="color: #098658">500</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #008000">// This means we are prepared to hold 500 * 20 = 10,000 docs in memory</span>
<span style="color: #000000">  </span><span style="color: #001080">maxConcurrentBatchCount:</span><span style="color: #000000"> </span><span style="color: #098658">20</span><span style="color: #000000">,</span>
<span style="color: #000000">});</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">docCount</span><span style="color: #000000"> } = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">traverser</span><span style="color: #000000">.</span><span style="color: #795E26">traverse</span><span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> (</span><span style="color: #001080">_</span><span style="color: #000000">, </span><span style="color: #001080">batchIndex</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Gonna process batch </span><span style="color: #0000FF">${</span><span style="color: #001080">batchIndex</span><span style="color: #0000FF">}</span><span style="color: #A31515"> now!`</span><span style="color: #000000">);</span>
<span style="color: #000000">  </span><span style="color: #008000">// ...</span>
<span style="color: #000000">});</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Traversed </span><span style="color: #0000FF">${</span><span style="color: #001080">docCount</span><span style="color: #0000FF">}</span><span style="color: #A31515"> projects super-fast!`</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#add-a-new-field-using-a-migrator" id="add-a-new-field-using-a-migrator" style="color: inherit; text-decoration: none;">
					<h3>Add a new field using a migrator</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">projectsColRef</span><span style="color: #000000"> = </span><span style="color: #795E26">firestore</span><span style="color: #000000">().</span><span style="color: #795E26">collection</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;projects&#039;</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">migrator</span><span style="color: #000000"> = </span><span style="color: #795E26">createBatchMigrator</span><span style="color: #000000">(</span><span style="color: #001080">projectsColRef</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">migratedDocCount</span><span style="color: #000000"> } = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">migrator</span><span style="color: #000000">.</span><span style="color: #795E26">update</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;isCompleted&#039;</span><span style="color: #000000">, </span><span style="color: #0000FF">false</span><span style="color: #000000">);</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Updated </span><span style="color: #0000FF">${</span><span style="color: #001080">migratedDocCount</span><span style="color: #0000FF">}</span><span style="color: #A31515"> projects!`</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#add-a-new-field-derived-from-the-previous-fields" id="add-a-new-field-derived-from-the-previous-fields" style="color: inherit; text-decoration: none;">
					<h3>Add a new field derived from the previous fields</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99">UserDoc</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">firstName</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #001080">lastName</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>
<span style="color: #000000">};</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">usersColRef</span><span style="color: #000000"> = </span><span style="color: #795E26">firestore</span><span style="color: #000000">().</span><span style="color: #795E26">collection</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;users&#039;</span><span style="color: #000000">) </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #267F99">firestore</span><span style="color: #000000">.</span><span style="color: #267F99">CollectionReference</span><span style="color: #000000">&lt;</span><span style="color: #267F99">UserDoc</span><span style="color: #000000">&gt;;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">migrator</span><span style="color: #000000"> = </span><span style="color: #795E26">createBatchMigrator</span><span style="color: #000000">(</span><span style="color: #001080">usersColRef</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">migratedDocCount</span><span style="color: #000000"> } = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">migrator</span><span style="color: #000000">.</span><span style="color: #795E26">updateWithDerivedData</span><span style="color: #000000">((</span><span style="color: #001080">snap</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">firstName</span><span style="color: #000000">, </span><span style="color: #0070C1">lastName</span><span style="color: #000000"> } = </span><span style="color: #001080">snap</span><span style="color: #000000">.</span><span style="color: #795E26">data</span><span style="color: #000000">();</span>
<span style="color: #000000">  </span><span style="color: #AF00DB">return</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #001080">fullName:</span><span style="color: #000000"> </span><span style="color: #A31515">`</span><span style="color: #0000FF">${</span><span style="color: #001080">firstName</span><span style="color: #0000FF">}</span><span style="color: #A31515"> </span><span style="color: #0000FF">${</span><span style="color: #001080">lastName</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">,</span>
<span style="color: #000000">  };</span>
<span style="color: #000000">});</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Updated </span><span style="color: #0000FF">${</span><span style="color: #001080">migratedDocCount</span><span style="color: #0000FF">}</span><span style="color: #A31515"> users!`</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#use-a-fast-migrator" id="use-a-fast-migrator" style="color: inherit; text-decoration: none;">
					<h3>Use a fast migrator</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">projectsColRef</span><span style="color: #000000"> = </span><span style="color: #795E26">firestore</span><span style="color: #000000">().</span><span style="color: #795E26">collection</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;projects&#039;</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">fastTraverser</span><span style="color: #000000"> = </span><span style="color: #795E26">createFastTraverser</span><span style="color: #000000">(</span><span style="color: #001080">projectsColRef</span><span style="color: #000000">, { </span><span style="color: #001080">maxConcurrentBatchCount:</span><span style="color: #000000"> </span><span style="color: #098658">25</span><span style="color: #000000"> });</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">fastMigrator</span><span style="color: #000000"> = </span><span style="color: #795E26">createBatchMigrator</span><span style="color: #000000">(</span><span style="color: #001080">fastTraverser</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">migratedDocCount</span><span style="color: #000000"> } = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">fastMigrator</span><span style="color: #000000">.</span><span style="color: #795E26">update</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;isCompleted&#039;</span><span style="color: #000000">, </span><span style="color: #0000FF">false</span><span style="color: #000000">);</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Updated </span><span style="color: #0000FF">${</span><span style="color: #001080">migratedDocCount</span><span style="color: #0000FF">}</span><span style="color: #A31515"> projects super-fast!`</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#change-traversal-config" id="change-traversal-config" style="color: inherit; text-decoration: none;">
					<h3>Change traversal config</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">walletsWithNegativeBalance</span><span style="color: #000000"> = </span><span style="color: #795E26">firestore</span><span style="color: #000000">().</span><span style="color: #795E26">collection</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;wallets&#039;</span><span style="color: #000000">).</span><span style="color: #795E26">where</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;money&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;&lt;&#039;</span><span style="color: #000000">, </span><span style="color: #098658">0</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">migrator</span><span style="color: #000000"> = </span><span style="color: #795E26">createBatchMigrator</span><span style="color: #000000">(</span><span style="color: #001080">walletsWithNegativeBalance</span><span style="color: #000000">, {</span>
<span style="color: #000000">  </span><span style="color: #008000">// We want each batch to have 500 docs. The size of the very last batch may be less than 500</span>
<span style="color: #000000">  </span><span style="color: #001080">batchSize:</span><span style="color: #000000"> </span><span style="color: #098658">500</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #008000">// We want to wait before moving to the next batch</span>
<span style="color: #000000">  </span><span style="color: #001080">sleepBetweenBatches:</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #008000">// We want to wait 500ms before moving to the next batch</span>
<span style="color: #000000">  </span><span style="color: #001080">sleepTimeBetweenBatches:</span><span style="color: #000000"> </span><span style="color: #098658">500</span><span style="color: #000000">,</span>
<span style="color: #000000">});</span>
<span style="color: #008000">// Wipe out their debts!</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">migratedDocCount</span><span style="color: #000000"> } = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">migrator</span><span style="color: #000000">.</span><span style="color: #795E26">set</span><span style="color: #000000">({ </span><span style="color: #001080">money:</span><span style="color: #000000"> </span><span style="color: #098658">0</span><span style="color: #000000"> });</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Updated </span><span style="color: #0000FF">${</span><span style="color: #001080">migratedDocCount</span><span style="color: #0000FF">}</span><span style="color: #A31515"> wallets!`</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#rename-an-optional-field" id="rename-an-optional-field" style="color: inherit; text-decoration: none;">
					<h3>Rename an optional field</h3>
				</a>
				<pre><code class="language-ts"><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99">PostDoc</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">text</span><span style="color: #000000">: </span><span style="color: #267F99">string</span><span style="color: #000000">;</span>
<span style="color: #000000">  </span><span style="color: #001080">postedAt</span><span style="color: #000000">?: </span><span style="color: #267F99">firestore</span><span style="color: #000000">.</span><span style="color: #267F99">Timestamp</span><span style="color: #000000">;</span>
<span style="color: #000000">};</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">postsColGroup</span><span style="color: #000000"> = </span><span style="color: #795E26">firestore</span><span style="color: #000000">().</span><span style="color: #795E26">collectionGroup</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;posts&#039;</span><span style="color: #000000">) </span><span style="color: #AF00DB">as</span><span style="color: #000000"> </span><span style="color: #267F99">firestore</span><span style="color: #000000">.</span><span style="color: #267F99">CollectionGroup</span><span style="color: #000000">&lt;</span><span style="color: #267F99">PostDoc</span><span style="color: #000000">&gt;;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">migrator</span><span style="color: #000000"> = </span><span style="color: #795E26">createBatchMigrator</span><span style="color: #000000">(</span><span style="color: #001080">postsColGroup</span><span style="color: #000000">);</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">migratedDocCount</span><span style="color: #000000"> } = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">migrator</span>
<span style="color: #000000">  .</span><span style="color: #795E26">withPredicate</span><span style="color: #000000">(</span>
<span style="color: #000000">    </span><span style="color: #008000">// Ignore if it doesn&#039;t have a `postedAt` field</span>
<span style="color: #000000">    (</span><span style="color: #001080">snap</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #001080">snap</span><span style="color: #000000">.</span><span style="color: #795E26">data</span><span style="color: #000000">().</span><span style="color: #001080">postedAt</span><span style="color: #000000"> !== </span><span style="color: #0000FF">undefined</span>
<span style="color: #000000">  )</span>
<span style="color: #000000">  .</span><span style="color: #795E26">updateWithDerivedData</span><span style="color: #000000">((</span><span style="color: #001080">snap</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">postedAt</span><span style="color: #000000"> } = </span><span style="color: #001080">snap</span><span style="color: #000000">.</span><span style="color: #795E26">data</span><span style="color: #000000">();</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> {</span>
<span style="color: #000000">      </span><span style="color: #001080">publishedAt:</span><span style="color: #000000"> </span><span style="color: #001080">postedAt</span><span style="color: #000000">!, </span><span style="color: #008000">// Safe to assert now</span>
<span style="color: #000000">      </span><span style="color: #001080">postedAt:</span><span style="color: #000000"> </span><span style="color: #001080">firestore</span><span style="color: #000000">.</span><span style="color: #001080">FieldValue</span><span style="color: #000000">.</span><span style="color: #795E26">delete</span><span style="color: #000000">(),</span>
<span style="color: #000000">    };</span>
<span style="color: #000000">  });</span>
<span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Updated </span><span style="color: #0000FF">${</span><span style="color: #001080">migratedDocCount</span><span style="color: #0000FF">}</span><span style="color: #A31515"> posts!`</span><span style="color: #000000">);</span>
</code></pre>
				<a href="#api" id="api" style="color: inherit; text-decoration: none;">
					<h2><a href="https://kafkas.github.io/firecode/">API</a></h2>
				</a>
				<p>You can find the full API reference for <code>@firecode/admin</code> <a href="https://kafkas.github.io/firecode/">here</a>. We maintain detailed docs for every version! Here are some of the core functions that this library provides.</p>
				<a href="#createtraverser" id="createtraverser" style="color: inherit; text-decoration: none;">
					<h3><a href="https://kafkas.github.io/firecode/0.7.2/modules.html#createtraverser">createTraverser</a></h3>
				</a>
				<p>Creates a traverser that facilitates Firestore collection traversals. When traversing the collection, this traverser invokes a specified async callback for each batch of document snapshots and waits for the callback Promise to resolve before moving to the next batch.</p>
				<a href="#complexity" id="complexity" style="color: inherit; text-decoration: none;">
					<h4>Complexity:</h4>
				</a>
				<ul>
					<li>Time complexity: <em>O</em>((<em>N</em> / <code>batchSize</code>) * (<em>Q</em>(<code>batchSize</code>) + <em>C</em>))</li>
					<li>Space complexity: <em>O</em>(<code>batchSize</code> * <em>D</em> + <em>S</em>)</li>
					<li>Billing: <em>max</em>(1, <em>N</em>) reads</li>
				</ul>
				<p>where:</p>
				<ul>
					<li><em>N</em>: number of docs in the traversable</li>
					<li><em>Q</em>(<code>batchSize</code>): average batch query time</li>
					<li><em>D</em>: average document size</li>
					<li><em>C</em>: average callback processing time</li>
					<li><em>S</em>: average extra space used by the callback</li>
				</ul>
				<a href="#createfasttraverser" id="createfasttraverser" style="color: inherit; text-decoration: none;">
					<h3><a href="https://kafkas.github.io/firecode/0.7.2/modules.html#createfasttraverser">createFastTraverser</a></h3>
				</a>
				<p>Creates a fast traverser that facilitates Firestore collection traversals. When traversing the collection, this traverser invokes a specified async callback for each batch of document snapshots and immediately moves to the next batch. It does not wait for the callback Promise to resolve before moving to the next batch so there is no guarantee that any given batch will finish processing before a later batch. This traverser uses more memory but is significantly faster than the default traverser.</p>
				<a href="#complexity-1" id="complexity-1" style="color: inherit; text-decoration: none;">
					<h4>Complexity:</h4>
				</a>
				<ul>
					<li>Time complexity: <em>O</em>(<em>C</em> + (<em>N</em> / <code>batchSize</code>) * <em>Q</em>(<code>batchSize</code>))</li>
					<li>Space complexity: <em>O</em>(<code>maxConcurrentBatchCount</code> * (<code>batchSize</code> * <em>D</em> + <em>S</em>))</li>
					<li>Billing: <em>max</em>(1, <em>N</em>) reads</li>
				</ul>
				<p>where:</p>
				<ul>
					<li><em>N</em>: number of docs in the traversable</li>
					<li><em>Q</em>(<code>batchSize</code>): average batch query time</li>
					<li><em>D</em>: average document size</li>
					<li><em>C</em>: average callback processing time</li>
					<li><em>S</em>: average extra space used by the callback</li>
				</ul>
				<a href="#createmigrator" id="createmigrator" style="color: inherit; text-decoration: none;">
					<h3><a href="https://kafkas.github.io/firecode/0.7.2/modules.html#createmigrator">createMigrator</a></h3>
				</a>
				<p>Creates a migrator that facilitates database migrations. The migrator accepts a custom traverser to traverse the collection. Otherwise it will create a default traverser with your desired traversal config. This migrator does not use atomic batch writes so it is possible that when a write fails other writes go through.</p>
				<a href="#complexity-2" id="complexity-2" style="color: inherit; text-decoration: none;">
					<h4>Complexity:</h4>
				</a>
				<ul>
					<li>Time complexity: <em>TC</em>(<code>traverser</code>) where <em>C</em> = <em>W</em>(<code>batchSize</code>)</li>
					<li>Space complexity: <em>SC</em>(<code>traverser</code>) where <em>S</em> = <em>O</em>(<code>batchSize</code>)</li>
					<li>Billing: <em>max</em>(1, <em>N</em>) reads, <em>K</em> writes</li>
				</ul>
				<p>where:</p>
				<ul>
					<li><em>N</em>: number of docs in the traversable</li>
					<li><em>K</em>: number of docs that passed the migration predicate (<em>K</em>&lt;=<em>N</em>)</li>
					<li><em>W</em>(<code>batchSize</code>): average batch write time</li>
					<li><em>TC</em>(<code>traverser</code>): time complexity of the underlying traverser</li>
					<li><em>SC</em>(<code>traverser</code>): space complexity of the underlying traverser</li>
				</ul>
				<a href="#createbatchmigrator" id="createbatchmigrator" style="color: inherit; text-decoration: none;">
					<h3><a href="https://kafkas.github.io/firecode/0.7.2/modules.html#createbatchmigrator">createBatchMigrator</a></h3>
				</a>
				<p>Creates a migrator that facilitates database migrations. The migrator accepts a custom traverser to traverse the collection. Otherwise it will create a default traverser with your desired traversal config. This migrator uses atomic batch writes so the entire operation will fail if a single write isn&#39;t successful.</p>
				<a href="#complexity-3" id="complexity-3" style="color: inherit; text-decoration: none;">
					<h4>Complexity:</h4>
				</a>
				<ul>
					<li>Time complexity: <em>TC</em>(<code>traverser</code>) where <em>C</em> = <em>W</em>(<code>batchSize</code>)</li>
					<li>Space complexity: <em>SC</em>(<code>traverser</code>) where <em>S</em> = <em>O</em>(<code>batchSize</code>)</li>
					<li>Billing: <em>max</em>(1, <em>N</em>) reads, <em>K</em> writes</li>
				</ul>
				<p>where:</p>
				<ul>
					<li><em>N</em>: number of docs in the traversable</li>
					<li><em>K</em>: number of docs that passed the migration predicate (<em>K</em>&lt;=<em>N</em>)</li>
					<li><em>W</em>(<code>batchSize</code>): average batch write time</li>
					<li><em>TC</em>(<code>traverser</code>): time complexity of the underlying traverser</li>
					<li><em>SC</em>(<code>traverser</code>): space complexity of the underlying traverser</li>
				</ul>
				<a href="#upgrading" id="upgrading" style="color: inherit; text-decoration: none;">
					<h2>Upgrading</h2>
				</a>
				<p>This project is still very new and we have a lot to work on. We will be moving fast and until we release v1, there may be breaking changes between minor versions (e.g. when upgrading from 0.4 to 0.5). However, all breaking changes will be documented and you can always use our <a href="https://github.com/kafkas/firecode/releases">Releases</a> page as a changelog.</p>
				<a href="#license" id="license" style="color: inherit; text-decoration: none;">
					<h2>License</h2>
				</a>
				<p>This project is made available under the MIT License.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/batchmigrator.html" class="tsd-kind-icon">Batch<wbr>Migrator</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/defaultmigrator.html" class="tsd-kind-icon">Default<wbr>Migrator</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/fasttraversalconfig.html" class="tsd-kind-icon">Fast<wbr>Traversal<wbr>Config</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/fasttraverser.html" class="tsd-kind-icon">Fast<wbr>Traverser</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/migrationresult.html" class="tsd-kind-icon">Migration<wbr>Result</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/migrator.html" class="tsd-kind-icon">Migrator</a>
					</li>
					<li class=" tsd-kind-interface tsd-is-external">
						<a href="interfaces/setoptions.html" class="tsd-kind-icon">Set<wbr>Options</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/slowtraverser.html" class="tsd-kind-icon">Slow<wbr>Traverser</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/traversalconfig.html" class="tsd-kind-icon">Traversal<wbr>Config</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/traversalresult.html" class="tsd-kind-icon">Traversal<wbr>Result</a>
					</li>
					<li class=" tsd-kind-interface">
						<a href="interfaces/traverseeachconfig.html" class="tsd-kind-icon">Traverse<wbr>Each<wbr>Config</a>
					</li>
					<li class=" tsd-kind-interface tsd-has-type-parameter">
						<a href="interfaces/traverser.html" class="tsd-kind-icon">Traverser</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#batchcallback" class="tsd-kind-icon">Batch<wbr>Callback</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#batchcallbackasync" class="tsd-kind-icon">Batch<wbr>Callback<wbr>Async</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#exitearlypredicate" class="tsd-kind-icon">Exit<wbr>Early<wbr>Predicate</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#migrationpredicate" class="tsd-kind-icon">Migration<wbr>Predicate</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#setdatagetter" class="tsd-kind-icon">Set<wbr>Data<wbr>Getter</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#traversable" class="tsd-kind-icon">Traversable</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#traverseeachcallback" class="tsd-kind-icon">Traverse<wbr>Each<wbr>Callback</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#updatedatagetter" class="tsd-kind-icon">Update<wbr>Data<wbr>Getter</a>
					</li>
					<li class=" tsd-kind-type-alias tsd-has-type-parameter">
						<a href="modules.html#updatefieldvaluegetter" class="tsd-kind-icon">Update<wbr>Field<wbr>Value<wbr>Getter</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="modules.html#createbatchmigrator" class="tsd-kind-icon">create<wbr>Batch<wbr>Migrator</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="modules.html#createfasttraverser" class="tsd-kind-icon">create<wbr>Fast<wbr>Traverser</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="modules.html#createmigrator" class="tsd-kind-icon">create<wbr>Migrator</a>
					</li>
					<li class=" tsd-kind-function tsd-has-type-parameter">
						<a href="modules.html#createtraverser" class="tsd-kind-icon">create<wbr>Traverser</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>